@using Fitness1919.Web.ViewModels.Product
@model ProductIndexViewModel

@{
    ViewData["Title"] = "Products";
}

<link rel="stylesheet" href="~/css/product/productsIndex.css">

<h1>Products</h1>
<p></p>
    <form asp-action="Index" method="get" class="filter-form">
        <label style="color:white" for="categoryFilter">Category:</label>
        <select id="categoryFilter" name="categoryFilter">
            <option value="">All Categories</option>
            @foreach (var category in Model.Categories)
            {
                <option value="@category.CategoryName">@category.CategoryName</option>
            }
        </select>

        <label style="color:white" for="brandFilter">Brand:</label>
        <select id="brandFilter" name="brandFilter">
            <option value="">All Brands</option>
            @foreach (var brand in Model.Brands)
            {
                <option value="@brand.BrandName">@brand.BrandName</option>
            }
        </select>

        <button type="submit">Filter</button>
    </form>
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">
        <p style="color:red;">@TempData["ErrorMessage"]</p>
    </div>
}

<div class="product-table">
    @if (Model.Products.Any())
    {
        @foreach (var item in Model.Products)
        {
            <div class="product-box">
                <img class="product-image" src="@item.img" alt="Image" />
                <div class="product-description">@Html.DisplayFor(modelItem => item.Description)</div>
                <div class="product-price">Price: @Html.DisplayFor(modelItem => item.Price) lv</div>
                <div>
                    @if (this.User.Identity.IsAuthenticated)
                    {
                        <form class="add-to-cart" asp-action="AddToCart" asp-controller="Products" method="post">
                            <input type="hidden" name="productId" value="@item.Id" />
                            <input type="number" name="quantity" value="1" min="1" required />
                            <button type="submit">Add to Cart</button>
                            @if (this.User.IsInRole("Administrator"))
                            {
                                <td>
                                    <a asp-action="Edit" asp-route-id="@item.Id">Edit</a> |
                                    <a asp-action="Delete" asp-route-id="@item.Id">Delete</a>
                                </td>
                            }
                        </form>
                    }
                </div>
            </div>
        }

    }
    else
    {
        <h2 style="color:red; position:center">No products were found!</h2>
    }
</div>
